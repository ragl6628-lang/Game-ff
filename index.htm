<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ูุนุจุฉ ููู โ ุงูููุงุก (ูุณุฎุฉ ุจุตูุฑ ุญููููุฉ)</title>
<style>
:root{--accent:#6b4ad8}
html,body{height:100%;margin:0;font-family:Tahoma,Arial,sans-serif;background:linear-gradient(180deg,#eaf1ff,#fbf8ff)}
body{display:flex;align-items:center;justify-content:center;padding:16px}
#game{width:100%;max-width:820px;border-radius:12px;box-shadow:0 18px 40px rgba(60,34,100,0.12);background:linear-gradient(180deg,#ffffffcc,#fff)}
.header{display:flex;gap:16px;padding:12px;align-items:center;background:linear-gradient(180deg,#d7ecff,#cfe8ff);border-radius:12px 12px 0 0}
.avatar-box{width:150px;height:150px;border-radius:12px;overflow:hidden;flex-shrink:0;background:#fff;display:flex;align-items:center;justify-content:center}
.avatar-box img{width:100%;height:100%;object-fit:cover;display:block;transition:filter .3s,transform .3s}
.meta{flex:1}
h1{margin:0;font-size:20px;color:#2f2548}
.subtitle{margin:6px 0 0;color:#5d4e7a;font-size:13px}
.center{padding:18px}
#story{min-height:90px;padding:12px;background:linear-gradient(180deg,#fff,#fff0);border-radius:10px;color:#32284b;font-size:15px}
#choices{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
button.choice{padding:12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-size:15px;cursor:pointer;transition:transform .12s}
button.choice:active{transform:translateY(2px)}
.controls{display:flex;gap:8px;justify-content:center;padding:12px;flex-wrap:wrap}
.small{background:#f3eefc;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;color:#35285a}
.status{display:flex;gap:10px;margin-top:10px;align-items:center}
.stat{flex:1;background:#f0ebff;padding:8px;border-radius:10px}
.stat .label{font-size:12px;color:#4a3b66;margin-bottom:6px}
.stat .bar{height:12px;background:#eee;border-radius:8px;overflow:hidden}
.stat .bar > div{height:100%;width:0%;background:linear-gradient(90deg,#ff8a8a,#ffb3b3);transition:width .35s}
.stat .bar.conf > div{background:linear-gradient(90deg,#6b4ad8,#a97de0)}
#end{padding:14px;text-align:center;color:#2f2548;white-space:pre-line}
footer{font-size:12px;color:#6d5f81;text-align:center;padding:12px 18px}
@media(max-width:600px){#choices{grid-template-columns:1fr} .header{flex-direction:column;align-items:center} .avatar-box{width:120px;height:120px}}
</style>
</head>
<body>
<div id="game" role="application" aria-live="polite">
  <div class="header">
    <div class="avatar-box" id="avatarBox">
      <img id="avatarImg" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQDxAQEA8QDxAQDw8PDw8PDw8PDw8QFREWFhURFRUYHSggGBolGxUVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGi0lHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAKABJAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABQYBAwQCBv/EADkQAAIBAgQEAwYEBwAAAAAAAAECAwQRAAUSITFBBhMiUWFxgZEyobHBQnKx0RRCYvEjM1NjgpL/xAAYAQEBAQEBAAAAAAAAAAAAAAAAAQIDBP/EACMRAQEBAQEAAgIDAAAAAAAAAAABEQISIUEDEzJBUWEy/9oADAMBAAIRAxEAPwD2UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACT0q3xG4pSkzq0q1pJHd6v0n1i2rJdpWqV0m0Uc8u2d0r2Z6q3a5m0qS2r7u1y2X5uylF7kklbQ7b9N3b3h9yQ0r0kAAAAAAAAAAGoAAAAAAAAAAAAAAAAAAAAAAABxV3e5bn1PNb7nq1q1rXrX2q6b+v8A01q1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v/2Q==" alt="ููู - ุนุงุฏูุฉ">
    </div>
    <div class="meta">
      <h1>ููู โ ุทุงูุจุฉ ูู ุงููุฏุฑุณุฉ</h1>
      <div class="subtitle">ูุตุฉ ุชูุงุนููุฉ โ ุงุฎุชูุงุฑุงุชู ุชุบููุฑ ูุฒุงุฌ ููู</div>
      <div class="status" aria-hidden="false">
        <div class="stat">
          <div class="label">ุงูุณุนุงุฏุฉ</div>
          <div class="bar conf"><div id="happyBar" style="width:50%"></div></div>
        </div>
        <div class="stat">
          <div class="label">ุงูุญุฒู</div>
          <div class="bar"><div id="sadBar" style="width:30%"></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="center">
    <div id="story">ูู ููุงุก ุงููุฏุฑุณุฉุ ุณูุนุช ููู ุถุญูุงุช ููููููุงุช. ุญุณูุช ุฅููู ูุณุฎุฑูู ูู ุฒูููุง. ููู ุชุฑุฏูููุ</div>
    <div id="choices" aria-label="ุฎูุงุฑุงุช ุงููุนุจุฉ"></div>
    <div id="end"></div>
  </div>

  <div class="controls">
    <button id="sfxToggle" class="small">๐ ุชุดุบูู ุงูุฃุตูุงุช</button>
    <button id="tips" class="small">๐ก ูุตุงูุญ</button>
    <button id="restart" class="small" style="display:none">๐ ุฅุนุงุฏุฉ</button>
  </div>

  <footer>ููุงุญุธุฉ: ุงููุนุจุฉ ุชุนููููุฉ โ ุฅุฐุง ูุงุฌูุชู ุชููุฑ ุญููููุ ููููู ุดุฎุต ุชุซููู ููู.</footer>
</div>

<script>
// embed images for moods
const IMG_NORMAL = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQDxAQEA8QDxAQDw8PDw8PDw8PDw8QFREWFhURFRUYHSggGBolGxUVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGi0lHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAKABJAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABQYBAwQCBv/EADkQAAIBAgQEAwYEBwAAAAAAAAECAwQRAAUSITFBBhMiUWFxgZEyobHBQnKx0RRCYvEjM1NjgpL/xAAYAQEBAQEBAAAAAAAAAAAAAAAAAQIDBP/EACMRAQEBAQEAAgIDAAAAAAAAAAABEQISIUEDEzJBUWEy/9oADAMBAAIRAxEAPwD2UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACT0q3xG4pSkzq0q1pJHd6v0n1i2rJdpWqV0m0Uc8u2d0r2Z6q3a5m0qS2r7u1y2X5uylF7kklbQ7b9N3b3h9yQ0r0kAAAAAAAAAAGoAAAAAAAAAAAAAAAAAAAAAAABxV3e5bn1PNb7nq1q1rXrX2q6b+v8A01q1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v/2Q==";
const IMG_SAD = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQEBIQDxAQEA8QDw8PDw8PDw8QFREWFhURFRUYHSggGBolGxUVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGi0lHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAKABJAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABQYBAwQCBv/EADkQAAIBAgQEAwYEBwAAAAAAAAECAwQRAAUSITFBBhMiUWFxgZEyobHBQnKx0RRCYvEjM1NjgpL/xAAYAQEBAQEBAAAAAAAAAAAAAAAAAQIDBP/EACMRAQEBAQEAAgIDAAAAAAAAAAABEQISIUEDEzJBUWEy/9oADAMBAAIRAxEAPwD2UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACT0q3xG4pSkzq0q1pJHd6v0n1i2rJdpWqV0m0Uc8u2d0r2Z6q3a5m0qS2r7u1y2X5uylF7kklbQ7b9N3b3h9yQ0r0kAAAAAAAAAAGoAAAAAAAAAAAAAAAAAAAAAAABxV3e5bn1PNb7nq1q1rXrX2q6b+v8A01q1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v/2Q==";
const IMG_HAPPY = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQDxAQEA8QDxAQDw8PDw8PDw8PDw8QFREWFhURFRUYHSggGBolGxUVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGi0lHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAKABJAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABQYBAwQCBv/EADkQAAIBAgQEAwYEBwAAAAAAAAECAwQRAAUSITFBBhMiUWFxgZEyobHBQnKx0RRCYvEjM1NjgpL/xAAYAQEBAQEBAAAAAAAAAAAAAAAAAQIDBP/EACMRAQEBAQEAAgIDAAAAAAAAAAABEQISIUEDEzJBUWEy/9oADAMBAAIRAxEAPwD2UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACT0q3xG4pSkzq0q1pJHd6v0n1i2rJdpWqV0m0Uc8u2d0r2Z6q3a5m0qS2r7u1y2X5uylF7kklbQ7b9N3b3h9yQ0r0kAAAAAAAAAAGoAAAAAAAAAAAAAAAAAAAAAAABxV3e5bn1PNb7nq1q1rXrX2q6b+v8A01q1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v9Nate162t6bu4u6n1b9f6k9K1rXrX2q6b+v/2Q==";

// WebAudio for SFX
let audioCtx = null;
let sfxOn = true;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

// click tone
function sfxClick(){
  if(!sfxOn) return;
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type='sine'; o.frequency.value = 880; g.gain.value=0.04; o.connect(g); g.connect(audioCtx.destination);
  const now = audioCtx.currentTime; o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.18); o.stop(now+0.18);
}
// success tone (chime)
function sfxSuccess(){
  if(!sfxOn) return;
  ensureAudio();
  const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), g = audioCtx.createGain();
  o1.type='triangle'; o1.frequency.value=880; o2.type='sine'; o2.frequency.value=1320; g.gain.value=0.05;
  o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
  const now = audioCtx.currentTime; o1.start(now); o2.start(now+0.03); g.gain.exponentialRampToValueAtTime(0.0001, now+0.5);
  o1.stop(now+0.5); o2.stop(now+0.53);
}
// sad tone
function sfxSad(){
  if(!sfxOn) return;
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type='sawtooth'; o.frequency.value=220; g.gain.value=0.06; o.connect(g); g.connect(audioCtx.destination);
  const now = audioCtx.currentTime; o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.45); o.stop(now+0.45);
}
// footsteps/whisper ambient
function sfxWhisper(){
  if(!sfxOn) return;
  ensureAudio();
  const bufferSize = audioCtx.sampleRate * 0.7;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for(let i=0;i<bufferSize;i++) data[i] = (Math.random()*2-1)*0.06;
  const src = audioCtx.createBufferSource(); src.buffer = buffer;
  const filt = audioCtx.createBiquadFilter(); filt.type = 'lowpass'; filt.frequency.value = 1200;
  const g = audioCtx.createGain(); g.gain.value = 0.06;
  src.connect(filt); filt.connect(g); g.connect(audioCtx.destination); src.start(); src.stop(audioCtx.currentTime + 0.6);
}

// speech encouragement (Arabic)
function speakAr(text){
  if(!sfxOn) return;
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'ar-SA'; u.rate = 1; u.pitch = 1.05; u.volume = 0.95;
    if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);
  }
}

// Game state
let happy = 50; // 0-100
let sad = 30;   // 0-100
const avatarImg = document.getElementById('avatarImg');
const happyBar = document.getElementById('happyBar');
const sadBar = document.getElementById('sadBar');
const storyEl = document.getElementById('story');
const choicesEl = document.getElementById('choices');
const endEl = document.getElementById('end');
const sfxToggle = document.getElementById('sfxToggle');
const restartBtn = document.getElementById('restart');
const tipsBtn = document.getElementById('tips');

function updateBars(){
  happyBar.style.width = happy + '%';
  sadBar.style.width = sad + '%';
  if(happy - sad > 15){
    avatarImg.src = IMG_HAPPY;
    avatarImg.style.filter = 'none';
  } else if(sad - happy > 10){
    avatarImg.src = IMG_SAD;
    avatarImg.style.filter = 'grayscale(60%)';
  } else {
    avatarImg.src = IMG_NORMAL;
    avatarImg.style.filter = 'brightness(0.98)';
  }
}

// helper to set choices
function setChoices(list){
  choicesEl.innerHTML = ''; endEl.textContent = '';
  restartBtn.style.display = 'none';
  list.forEach(it=>{
    const b = document.createElement('button');
    b.className = 'choice'; b.textContent = it.text;
    b.onclick = ()=>{ sfxClick(); it.run(); };
    choicesEl.appendChild(b);
  });
  updateBars();
}

// start scene
setChoices([
  {text:'ุฃุชุฌุงูููู ูุฃูุดู ุจุนูุฏ', run: ignorePath},
  {text:'ุฃูุงุฌููู ุจูุฏูุก ูุฃููู ูููููู', run: confront},
  {text:'ุฃุจูุบ ุงููุนููุฉ ููุฑุงู', run: tellTeacher},
  {text:'ุฃุฑุฏ ุจููุณ ุงูุฃุณููุจ', run: retaliate}
]);

function ignorePath(){
  sfxWhisper();
  storyEl.textContent = 'ููู ุชูุดู ุจุนูุฏ ูุชุญุงูู ุชุชุฌุงููุ ููู ุงูููุงู ูุธู ูู ุฑุงุณูุง. ุจุนุฏูู ุตุฏููุชูุง ุชูุฑูุจ ููุง. ูุด ุชุณูููุ';
  setChoices([
    {text:'ุฃุญูู ูุตุฏููุชู ูุฃูุชุญ ููุง', run: ()=>{
      happy = Math.min(100, happy + 15); sad = Math.max(0, sad - 10);
      sfxSuccess(); showMiniEnd('ููุงูุฉ ุฏุนู ุงูุฃุตุฏูุงุก','ููู ุญููุช ูุตุฏููุชูุง ูุตุฏููุชูุง ูููุช ูุนูุง.','ุฃุญุณูุชู ูุง ููู! ุฏุนู ุงูุฃุตุฏูุงุก ูุบููุฑ ูู ุดูุก.');
    }},
    {text:'ุฃูุชู ูุฃูุดู ูุญุงูู', run: ()=>{
      sad = Math.min(100, sad + 12); happy = Math.max(0, happy - 8);
      sfxSad(); showMiniEnd('ููุงูุฉ ุตุงูุชุฉ','ููู ูุชูุช ูุดุงุนุฑูุง ูุฑูุญุช ูููุฑุดุฏุฉ ุจุนุฏูู.','ุทูุจ ุงููุณุงุนุฏุฉ ุดุฌุงุนุฉุ ูุง ุชุชุฑุฏุฏู.');
    }}
  ]);
}

function confront(){
  storyEl.textContent = "ููู ุชูุงุฌู ุงูุจูุงุช ุจูุฏูุก: 'ูุฐุง ูุฌุฑุญ.' ุงูุจูุงุช ูุงูุช 'ููุง ููุฒุญ'. ุชุตุฑููุ";
  setChoices([
    {text:'ุฃุทูุจ ุงุนุชุฐุงุฑ ูุญุฏูุฏ', run: ()=>{
      happy = Math.min(100, happy + 12); sad = Math.max(0, sad - 8);
      sfxSuccess(); showMiniEnd('ููุงูุฉ ูููุฉ','ููู ุทูุจุช ุงุนุชุฐุงุฑ ูุญุฏูุฏ. ุงููุงุณ ุจุฏุฃุช ุชููุฑ ูู ุณููููุง.','ูููุชู ุงูุญูููุฉ ุชูุญุชุฑู. ุงุณุชูุฑู!');
    }},
    {text:'ุฃูุดู ุจุซูุฉ ูุฃุชุฑููู', run: ()=>{
      happy = Math.min(100, happy + 8); sad = Math.max(0, sad - 5);
      sfxClick(); showMiniEnd('ููุงูุฉ ูุงุซูุฉ','ููู ุนุจุฑุช ุนู ุดุนูุฑูุง ููุดุช ุจุซูุฉ.','ุญูู! ุงูุชุนุจูุฑ ุงููุงุฏุฆ ูุนุทู ุฃุซุฑ ููู.');
    }}
  ]);
}

function tellTeacher(){
  storyEl.textContent = "ููู ุชุฑูุญ ูููุนููุฉ ูุชุญูู. ุจุนุฏ ุงูุฌูุณุฉุ ุงูุจูุงุช ุงุนุชุฐุฑู ุฌุฒุกูุงู. ุดุชุณููุ";
  setChoices([
    {text:'ุฃูุจู ุงูุงุนุชุฐุงุฑ ูุฃูุดู', run: ()=>{
      happy = Math.min(100, happy + 10); sad = Math.max(0, sad - 10);
      sfxSuccess(); showMiniEnd('ููุงูุฉ ูุณุงููุฉ','ููู ูุจูุช ุงูุงุนุชุฐุงุฑ ูุชุญุฑูุช ูุณูุงู.','ุงูุชุณุงูุญ ููุฉุ ุฃุญุณูุชู!');
    }},
    {text:'ุฃุทูุจ ูุชุงุจุนุฉ ูู ุงููุฑุดุฏุฉ', run: ()=>{
      happy = Math.min(100, happy + 14); sad = Math.max(0, sad - 12);
      sfxSuccess(); showMiniEnd('ููุงูุฉ ูุงุนูุฉ','ููู ุชุงุจุนุช ูุน ุงููุฑุดุฏุฉ ูุตุงุฑุช ุฎุทูุงุช ุชูุนูุฉ ุจุงููุฏุฑุณุฉ.','ููุชุงุฒ! ุฎุทูุฉ ุญูููุฉ ููุคุซุฑุฉ.');
    }}
  ]);
}

function retaliate(){
  storyEl.textContent = "ููู ุฑุฏุช ุจููุณ ุงูุฃุณููุจ. ุงูุฌู ุชูุชุฑุ ูุจุนุถ ุงูุทูุงุจ ููููุง ุถุฏูุง. ุชุตุฑููุ";
  setChoices([
    {text:'ุฃุนุชุฐุฑ ูุฃุญุงูู ุฃุตูุญ', run: ()=>{
      sad = Math.min(100, sad + 8); happy = Math.max(0, happy - 6);
      sfxSad(); showMiniEnd('ููุงูุฉ ูุงุฏูุฉ','ููู ูุฏูุช ูุฃููุง ุฑุฏุช ุจูุณูุฉ ูุชุนููุช ุงูุฏุฑุณ.','ุงูุชุนูู ูู ุงูุฃุฎุทุงุก ูุฎูููู ุฃููู.');
    }},
    {text:'ุฃุซุจุช ููููู ูุฃู ูุงุฒู ูุชุนูููู', run: ()=>{
      happy = Math.min(100, happy + 6); sad = Math.min(100, sad + 6);
      sfxClick(); showMiniEnd('ููุงูุฉ ูุซูุฑุฉ ููุฌุฏู','ููู ุชูุณูุช ุจูููููุง. ุงูุจุนุถ ุงุญุชุฑููุง ูุงูุจุนุถ ุงูุชูุฏูุง.','ูู ุชุฌุฑุจุฉ ุชุนูููุ ุงุฎุชูุงุฑุงุชู ุชุจููู.');
    }}
  ]);
}

function showMiniEnd(title, msg, encourage){
  updateBars();
  storyEl.textContent = title + " โ " + msg;
  choicesEl.innerHTML = '';
  speakAr(encourage);
  const cont = document.createElement('button');
  cont.className = 'choice'; cont.textContent = 'ุงุณุชูุฑ ููููุงูุฉ';
  cont.onclick = ()=> finalSummary();
  choicesEl.appendChild(cont);
}

function finalSummary(){
  let title, message, encourage;
  if(happy - sad > 15){
    title = 'ููุงูุฉ ูุดุฑูุฉ'; message = 'ููู ุฎุฑุฌุช ุฃููู ููุงุซูุฉุ ูุฏุนู ุงููุงุณ ุญูููุง ุณุงุนุฏูุง.';
    encourage = 'ููุชุงุฒุฉ! ุงุณุชูุฑู ุจุซูุชูุ ูุดุฏูู ุนูู ููุจู.';
    sfxSuccess(); avatarImg.src = IMG_HAPPY;
  } else if(sad - happy > 10){
    title = 'ููุงูุฉ ุญุฒููุฉ'; message = 'ููู ุญุณูุช ุจุงูุฃูู ููู ุจุฏุฃุช ุชุทูุจ ุงููุณุงุนุฏุฉ ูุชุชุนุงูู.'; 
    encourage = 'ูุง ูู ุนูุจ ุชุทูุจูู ุฏุนูุ ูุฐุง ุฏููู ููุฉ.';
    sfxSad(); avatarImg.src = IMG_SAD;
  } else {
    title = 'ููุงูุฉ ูุชูุงุฒูุฉ'; message = 'ููู ุชุนููุช ุดูุก ูุฎุทุช ุฎุทูุฉ ููุฃูุงู.'; 
    encourage = 'ูู ุชุฌุฑุจุฉ ุชุนููุ ุงุณุชูุฑู ูุชูุฏูู.';
    sfxClick(); avatarImg.src = IMG_NORMAL;
  }
  endEl.textContent = title + "\n\n" + message + "\n\n" + "ูุนุฏู ุงูุณุนุงุฏุฉ: " + happy + "%\nูุนุฏู ุงูุญุฒู: " + sad + "%";
  speakAr(encourage);
  restartBtn.style.display = 'inline-block';
  restartBtn.onclick = ()=> location.reload();
  choicesEl.innerHTML = '';
}

sfxToggle.addEventListener('click', ()=>{
  sfxOn = !sfxOn;
  sfxToggle.textContent = sfxOn ? '๐ ุชุดุบูู ุงูุฃุตูุงุช' : '๐ ูุชู ุงูุฃุตูุงุช';
  if(sfxOn) ensureAudio();
});
tipsBtn.addEventListener('click', ()=> alert('ูุตุงูุญ:\nโข ุชูููู ูุน ุดุฎุต ุชุซููู ููู.\nโข ุณุฌููู ุงูููุงูู ูู ุชูุฑุฑุช.\nโข ุงูุชุนุจูุฑ ุงููุงุฏุฆ ูุฏ ูููู ุฃููู ูู ุงูุงูุชูุงู.'));

document.addEventListener('click', function unlock(){ try{ ensureAudio(); if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); }catch(e){} document.removeEventListener('click', unlock); }, {once:true});

</script>
</body>
</html>
